<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Mohamed Tech | Booking</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1>Mohamed Tech</h1>
    <div class="subtitle">نظام حجز لحل منصة البرمجة</div>

    <form id="bookingForm">
        <label>الاسم الرباعي</label>
        <input type="text" name="full_name" placeholder="مثال: محمد أحمد علي حسن" required>

        <label>الفصل</label>
        <select name="class" required>
            <option value="">اختر الفصل</option>
            <option>1/1</option>
            <option>1/2</option>
            <option>1/3</option>
            <option>1/4</option>
            <option>1/5</option>
        </select>

        <label>اسم المنصة</label>
        <input type="text" name="platform_name" placeholder="اسم المنصة" required>

        <label>كود المنصة</label>
        <input type="text" name="platform_code" placeholder="اكتب الكود هنا" required>

        <label>طريقة الدفع</label>
        <select name="payment_method" id="paymentMethod" required>
            <option value="">اختر طريقة الدفع</option>
            <option value="vodafone">Vodafone Cash</option>
            <option value="cash">Cash</option>
        </select>

        <label>حالة الحجز</label>
        <select name="booking_speed" id="bookingSpeed" required>
            <option value="">اختر السرعة</option>
            <option value="normal">عادي (100 جنيه)</option>
            <option value="urgent">مستعجل (120 جنيه)</option>
        </select>

        <label>البريد الإلكتروني</label>
        <input type="email" name="email" placeholder="example@gmail.com" required>

        <button type="submit">تأكيد الحجز</button>
    </form>

    <a href="track.html">متابعة حالة الحجز</a>
</div>

<div id="popupOverlay">
  <div id="popupBox">
    <h2 id="popupTitle"></h2>
    <p id="popupText"></p>
    <button id="popupBtn">تمام</button>
  </div>
</div>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
(function(){ emailjs.init('QWrTiK1BOSDjZaijS'); })();

const form = document.getElementById('bookingForm');
const popupOverlay = document.getElementById('popupOverlay');
const popupTitle = document.getElementById('popupTitle');
const popupText = document.getElementById('popupText');
const popupBtn = document.getElementById('popupBtn');

let lastId = localStorage.getItem('lastBookingId') || 20;

function showPopup(title, text){
  popupTitle.textContent = title;
  popupText.textContent = text;
  popupOverlay.style.display = 'flex';
}
popupBtn.addEventListener('click', () => { popupOverlay.style.display = 'none'; });

form.addEventListener('submit', function(event){
    event.preventDefault();

    const paymentMethod = document.getElementById('paymentMethod').value;
    const bookingSpeed = document.getElementById('bookingSpeed').value;
    const email = form.email.value;

    if(!paymentMethod || !bookingSpeed){
        alert('اختر طريقة الدفع وسرعة الحجز أولاً');
        return;
    }

    // الرقم المسلسل
    lastId = parseInt(lastId) + 1;
    localStorage.setItem('lastBookingId', lastId);

    // إرسال البيانات عبر EmailJS
    emailjs.sendForm('service_dsxhs5v','template_ul985hd',form)
        .then(function(){
            // Pop-up حسب الدفع والسرعة
            let msg = '';
            if(paymentMethod === 'vodafone'){
                msg = 'سنبدأ في حل منصتك في أقرب وقت. رقم حجزك: ' + lastId;
            } else {
                msg = 'برجاء التوجه لمحمد سامح ودفع '+ (bookingSpeed==='urgent'?'120':'100') +' جنيه كاش. رقم حجزك: ' + lastId;
            }
            showPopup('تم تسجيل الحجز ✅', msg);

            // حفظ بيانات للحجز للمتابعة
            let bookings = JSON.parse(localStorage.getItem('bookings')||'[]');
            bookings.push({id:lastId,email:email,status:'في الانتظار'});
            localStorage.setItem('bookings', JSON.stringify(bookings));

            form.reset();
        }, function(error){
            alert('حصل خطأ في إرسال الحجز، حاول مرة أخرى.');
            console.log(error);
        });
});
</script>

</body>
</html>
