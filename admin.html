<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samo Admin | لوحة التحكم الاحترافية</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- 1. التأسيس والمتغيرات (The Foundation) --- */
        :root {
            --primary: #22c55e;
            --secondary: #3b82f6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-darker: #020617;
            --bg-card: #0f172a;
            --glass: rgba(30, 41, 59, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: var(--bg-darker);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- 2. نظام الدفع والأمان (Login System) --- */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-darker);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
        }

        .login-card {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 30px;
            border: 1px solid var(--border);
            text-align: center;
            width: 350px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        .login-card i {
            font-size: 50px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-card input {
            width: 100%;
            padding: 15px;
            background: #000;
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--primary);
            text-align: center;
            font-size: 20px;
            margin-bottom: 20px;
            outline: none;
        }

        .login-card button {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: #000;
            border: none;
            border-radius: 12px;
            font-weight: 900;
            cursor: pointer;
        }

        /* --- 3. تصميم لوحة التحكم (Dashboard Layout) --- */
        .dashboard-container {
            max-width: 1100px;
            margin: auto;
            padding: 40px 20px;
            display: none; /* تظهر بعد الدخول */
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .top-bar h1 {
            font-size: 28px;
            background: linear-gradient(to left, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* --- 4. كروت الإحصائيات (Stats Grid) --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--glass);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
        }

        .stat-card h3 {
            color: var(--text-gray);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 900;
            color: var(--primary);
        }

        /* --- 5. أدوات التحكم (Controls) --- */
        .controls-area {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 2;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 45px 15px 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
            outline: none;
        }

        .search-box i {
            position: absolute;
            right: 15px;
            top: 18px;
            color: var(--primary);
        }

        .filter-select {
            flex: 1;
            padding: 10px;
            background: var(--bg-card);
            color: white;
            border-radius: 12px;
            border: 1px solid var(--border);
            outline: none;
        }

        /* --- 6. الجدول العملاق (The Master Table) --- */
        .table-container {
            background: var(--bg-card);
            border-radius: 25px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(255, 255, 255, 0.05);
        }

        th {
            padding: 20px;
            text-align: right;
            font-size: 14px;
            color: var(--primary);
        }

        td {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        /* الحالات Status Styles */
        .badge {
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: bold;
        }

        .badge-pending { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .badge-done { background: rgba(34, 197, 94, 0.1); color: var(--primary); }

        /* الأزرار داخل الجدول */
        .action-btn {
            padding: 8px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            margin-left: 5px;
            transition: 0.2s;
        }

        .btn-view { background: var(--secondary); color: white; }
        .btn-delete { background: var(--danger); color: white; }

        /* --- 7. التفاصيل الموسعة (Detailed View) --- */
        .details-row {
            background: #000 !important;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn { from { opacity:0; } to { opacity:1; } }

        .details-content {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .detail-item {
            font-size: 13px;
            color: #94a3b8;
        }

        .detail-item span { color: white; margin-right: 5px; font-weight: bold; }

        /* --- 8. فوتر اللوحة --- */
        .admin-footer {
            margin-top: 40px;
            text-align: center;
            color: #475569;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-overlay">
        <div class="login-card">
            <i class="fas fa-user-shield"></i>
            <h2>Samo Command Center</h2>
            <p style="color:#64748b; margin-bottom:20px; font-size:12px;">ممنوع دخول غير المصرح لهم</p>
            <input type="password" id="adminPass" placeholder="كلمة المرور">
            <button onclick="unlockDashboard()">فتح النظام</button>
        </div>
    </div>

    <div id="mainDashboard" class="dashboard-container">
        
        <div class="top-bar">
            <h1>لوحة تحكم سيمو ⚡</h1>
            <button onclick="window.location.reload()" class="action-btn" style="background:var(--card-bg); color:white; border:1px solid var(--border); padding:10px 20px;">
                <i class="fas fa-sync-alt"></i> تحديث البيانات
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3><i class="fas fa-users"></i> إجمالي الطلاب</h3>
                <div class="value" id="count_total">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-wallet"></i> الأرباح (ج.م)</h3>
                <div class="value" id="count_money">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-hourglass-half"></i> طلبات معلقة</h3>
                <div class="value" id="count_pending">0</div>
            </div>
            <div class="stat-card">
                <h3><i class="fas fa-check-double"></i> مكتمل</h3>
                <div class="value" id="count_done">0</div>
            </div>
        </div>

        <div class="controls-area">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="adminSearch" placeholder="ابحث بالاسم، الكود، أو المدرسة..." onkeyup="renderTable()">
            </div>
            <select class="filter-select" id="statusFilter" onchange="renderTable()">
                <option value="all">كل الحالات</option>
                <option value="تم الاستلام">تم الاستلام</option>
                <option value="تم الانتهاء">تم الانتهاء</option>
            </select>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>رقم الدور</th>
                        <th>اسم الطالب</th>
                        <th>المدرسة</th>
                        <th>الحالة</th>
                        <th>الدفع</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody id="adminTbody">
                    </tbody>
            </table>
        </div>

        <div style="margin-top:20px;">
            <button onclick="clearSystem()" style="color:var(--danger); background:none; border:none; cursor:pointer; font-size:12px;">
                <i class="fas fa-trash"></i> تفريغ قاعدة البيانات بالكامل (بداية ترم جديد)
            </button>
        </div>

        <div class="admin-footer">
            <p>جميع الحقوق محفوظة لـ Samo Solutions &copy; 2026</p>
        </div>
    </div>

    <script>
        // --- أمان النظام ---
        function unlockDashboard() {
            const pass = document.getElementById('adminPass').value;
            if(pass === "Mody1234m@") {
                document.getElementById('loginScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainDashboard').style.display = 'block';
                    renderTable();
                }, 400);
            } else {
                alert("الباسورد غلط يا بطل.. حاول تاني!");
            }
        }

        // --- جلب وعرض البيانات ---
        function renderTable() {
            const db = JSON.parse(localStorage.getItem('samo_db') || '[]');
            const tbody = document.getElementById('adminTbody');
            const searchQuery = document.getElementById('adminSearch').value.toLowerCase();
            const filterValue = document.getElementById('statusFilter').value;
            
            tbody.innerHTML = '';
            let totalMoney = 0;
            let pendingCount = 0;
            let doneCount = 0;

            db.forEach((item, index) => {
                // الفلترة
                const matchesSearch = item.name.toLowerCase().includes(searchQuery) || item.pcode.includes(searchQuery);
                const matchesFilter = filterValue === 'all' || item.status === filterValue;

                if(matchesSearch && matchesFilter) {
                    // حساب الإحصائيات
                    if(item.pay_status === 'تم الدفع') totalMoney += 50; // افتراض السعر 50
                    if(item.status === 'تم الاستلام') pendingCount++;
                    if(item.status === 'تم الانتهاء') doneCount++;

                    // بناء الصف الرئيسي
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="color:var(--primary); font-weight:bold;">#${item.id}</td>
                        <td>${item.name}</td>
                        <td>${item.school}</td>
                        <td><span class="badge ${item.status === 'تم الانتهاء' ? 'badge-done' : 'badge-pending'}">${item.status}</span></td>
                        <td>
                            <button onclick="togglePay(${index})" style="background:none; border:1px solid #334155; color:white; padding:4px 8px; border-radius:5px; font-size:10px; cursor:pointer;">
                                ${item.pay_status}
                            </button>
                        </td>
                        <td>
                            <button class="action-btn btn-view" onclick="toggleDetails(${index})"><i class="fas fa-eye"></i></button>
                            <button class="action-btn btn-delete" onclick="deleteItem(${index})"><i class="fas fa-trash-alt"></i></button>
                            <button class="action-btn" style="background:var(--primary)" onclick="toggleStatus(${index})"><i class="fas fa-check"></i></button>
                        </td>
                    `;
                    tbody.appendChild(tr);

                    // بناء صف التفاصيل المخفي
                    const detailTr = document.createElement('tr');
                    detailTr.id = `details-${index}`;
                    detailTr.className = 'details-row';
                    detailTr.innerHTML = `
                        <td colspan="6">
                            <div class="details-content">
                                <div class="detail-item">الفصل: <span>${item.class}</span></div>
                                <div class="detail-item">الإيميل: <span>${item.email}</span></div>
                                <div class="detail-item">كود المنصة: <span style="color:var(--primary)">${item.pcode}</span></div>
                                <div class="detail-item">الباسورد: <span style="color:var(--danger)">${item.ppass}</span></div>
                                <div class="detail-item">التحويل من: <span>${item.pay_ph || 'N/A'}</span></div>
                                <div class="detail-item">وقت التحويل: <span>${item.pay_time || 'N/A'}</span></div>
                                <div class="detail-item">تاريخ الحجز: <span>${item.timestamp}</span></div>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(detailTr);
                }
            });

            // تحديث العدادات
            document.getElementById('count_total').innerText = db.length;
            document.getElementById('count_money').innerText = totalMoney;
            document.getElementById('count_pending').innerText = pendingCount;
            document.getElementById('count_done').innerText = doneCount;
        }

        // --- وظائف الأزرار ---
        function toggleDetails(index) {
            const el = document.getElementById(`details-${index}`);
            el.style.display = (el.style.display === 'table-row') ? 'none' : 'table-row';
        }

        function toggleStatus(index) {
            let db = JSON.parse(localStorage.getItem('samo_db'));
            db[index].status = (db[index].status === 'تم الاستلام') ? 'تم الانتهاء' : 'تم الاستلام';
            localStorage.setItem('samo_db', JSON.stringify(db));
            renderTable();
        }

        function togglePay(index) {
            let db = JSON.parse(localStorage.getItem('samo_db'));
            db[index].pay_status = (db[index].pay_status === 'تم الدفع') ? 'قيد المراجعة' : 'تم الدفع';
            localStorage.setItem('samo_db', JSON.stringify(db));
            renderTable();
        }

        function deleteItem(index) {
            if(confirm("هل أنت متأكد من حذف هذا الحجز نهائياً؟")) {
                let db = JSON.parse(localStorage.getItem('samo_db'));
                db.splice(index, 1);
                localStorage.setItem('samo_db', JSON.stringify(db));
                renderTable();
            }
        }

        function clearSystem() {
            if(confirm("تحذير: سيتم مسح كافة البيانات المسجلة! هل أنت متأكد؟")) {
                localStorage.removeItem('samo_db');
                renderTable();
            }
        }
    </script>
</body>
</html>
